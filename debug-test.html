<!DOCTYPE html>
<html>
<head>
    <title>API Debug Test</title>
</head>
<body>
    <h1>Task Manager API Debug Test</h1>
    
    <div>
        <h2>Test User Credentials:</h2>
        <p><strong>Email:</strong> test@test.com</p>
        <p><strong>Password:</strong> Test123!</p>
    </div>

    <div>
        <h2>Registration Test</h2>
        <button onclick="testRegister()">Test Register</button>
        <div id="registerResult"></div>
    </div>

    <div>
        <h2>Login Test</h2>
        <button onclick="testLogin()">Test Login</button>
        <div id="loginResult"></div>
    </div>

    <div>
        <h2>Console Output</h2>
        <div id="console"></div>
    </div>

    <script>
        const API_BASE = 'http://34.10.117.155';
        
        function log(message) {
            console.log(message);
            document.getElementById('console').innerHTML += '<p>' + JSON.stringify(message) + '</p>';
        }

        async function testRegister() {
            try {
                log('Testing registration...');
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: 'debug-test@example.com',
                        password: 'Test123!',
                        firstName: 'Debug',
                        lastName: 'Test'
                    })
                });
                
                const data = await response.json();
                log('Register response: ' + response.status);
                log(data);
                document.getElementById('registerResult').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                log('Register error: ' + error.message);
                document.getElementById('registerResult').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        async function testLogin() {
            try {
                log('Testing login...');
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: 'test@test.com',
                        password: 'Test123!'
                    })
                });
                
                const data = await response.json();
                log('Login response: ' + response.status);
                log(data);
                document.getElementById('loginResult').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                log('Login error: ' + error.message);
                document.getElementById('loginResult').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        // Test CORS preflight
        log('Testing CORS preflight...');
        fetch(`${API_BASE}/api/auth/login`, {
            method: 'OPTIONS',
            headers: {
                'Origin': window.location.origin,
                'Access-Control-Request-Method': 'POST',
                'Access-Control-Request-Headers': 'content-type'
            }
        }).then(response => {
            log('CORS preflight status: ' + response.status);
            log('CORS headers: ' + JSON.stringify([...response.headers.entries()]));
        }).catch(error => {
            log('CORS preflight error: ' + error.message);
        });
    </script>
</body>
</html>
